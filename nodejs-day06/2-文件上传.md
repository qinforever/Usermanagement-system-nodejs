## form 表单的 enctype 属性

| 属性值                            | 描述                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| application/x-www-form-urlencoded | 在发送前编码所有字符（默认）                                 |
| multipart/form-data               | 不对字符编码。在使用包含文件上传控件的表单时，必须使用该值。 |
| text/plain                        | 空格转换为 "+" 加号，但不对特殊字符编码。                    |

## **multer** 中间件 实现上传文件功能

1. 下载引入
2. 设置存储目录
```js
const upload = multer({
  dest: 'C:/tmp/'
})
```
3. 在上传路由的处理函数之前使用 **multer** 中间件做处理

    - single(fieldname)
    > 接受一个以 fieldname 命名的文件。这个文件的信息保存在 req.file
    ```js
    router.post('/upload', upload.single(fieldname), function(req, res) {
      console.log(req.file); // 通过 req.file 能获取 文件的信息
      ...
    });
    // fieldname 是 file控件 设置 name属性值
    ```

    - array(fieldname[, maxCount])
    > 接受一个以 fieldname 命名的文件数组。可以配置 maxCount 来限制上传的最大数量。这些文件的信息保存在 req.files。
    ```js
    router.post('/upload', upload.array(fieldname[, maxCount]), function(req, res) {
      console.log(req.files); // 通过 req.files 能获取 文件信息，注意是 数组
      ...
    })
    // maxCount 限制上传的最大数量
    ```

    - fields(fields)
    > 接受指定 fields 的混合文件。这些文件的信息保存在 req.files。
    ```js
    router.post('/upload', upload.fields(fields), function(req, res) {
      console.log(req.files); // 通过 req.files 能获取 文件信息，注意是 数组
      ...
    })
    // fields 是个对象数组
    // [
    //   {name: 'mobile', maxCount: 1},
    //   {name: 'gallery', maxCount: 8},
    // ]
    ```

    - none()
    > 只接受文本域。如果任何文件上传到这个模式，将发生 "LIMIT_UNEXPECTED_FILE" 错误。这和 upload.fields([]) 的效果一样。

    - any()
    > 接受一切上传的文件。文件数组将保存在 req.files。
    ```js
    router.post('/upload', upload.any(), function(req, res) {
      console.log(req.files); // 通过 req.files 能获取 文件信息，注意是 数组
      ...
    })
    ```
4. 操作文件
```js
router.post('/upload', upload.single('mobile'), function(req, res) {
    // 4.1 设置文件写入路径
    // 4.2 读取并写入
})
```

## **multer** 文件属性

| 属性名       | 描述                          |
| ------------ | ----------------------------- |
| fieldname    | Field name 由表单指定         |
| originalname | 文件原始名称                  |
| encoding     | 文件编码                      |
| mimetype     | 文件的 MIME 类型              |
| size         | 文件大小（字节单位）          |
| destination  | 保存路径                      |
| filename     | 保存在 destination 中的文件名 |
| path         | 已上传文件的完整路径          |

